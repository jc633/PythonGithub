$(function() {
	$('#head_bar1').attr('id', 'head_bar');
	//关闭自动填充
	$('input').attr('autocomplete', 'off');
	var sm = new Vue({
		el: "#accountSet",
	    data:{
	     acts:{'基本信息':'#basicInfor','账号密码':'#accout','更多设置':'#newsNotice'},
	     changePwd:true,
	     alterPwd:false,
	     listen:false, //取消按钮监听
	    },
	    methods:{
	    	chooseImg:function(){
	    		$('.userImg').addClass('uImg');
	    		$('#upImg').click();
	    	},
	    	//解除锁定
	    	dropDisabled:function(index){
	    		$('.saveInfor').eq(index).removeAttr('disabled');
	    	},
	    	addDisabled:function(index){
	    		$('.saveInfor').eq(index).attr('disabled', 'disabled');
	    	},
	    	//获取图片路径
			  getImgUrl:function(file) { 
			　　var url = null ; 
			　　if (window.createObjectURL!=undefined) { 
			　　　　url = window.createObjectURL(file) ; 
			　　} else if (window.URL!=undefined) { 
			　　　　url = window.URL.createObjectURL(file) ; 
			　　} else if (window.webkitURL!=undefined) { 
			　　　　url = window.webkitURL.createObjectURL(file) ; 
			　　} 
			　　return url ; 
			  },
			 //文件检测
			   checkFile:function (file,min,max) {
				   	if(min>max){var c = min;min = max;max=c;} //防止用户输反参数
					var reg = /\S+\.jpg|png|JPG|PNG|jpeg|JPEG/; //图片验证
					var Minsize = min*1024; 
					var Maxsize = max*1024; 
					min = min>=1024?(min/1024)+'M':min+'kb'; //单位检测
					max = max>=1024?(max/1024)+'M':max+'kb';
					var result = '';
					if(reg.test(file.name)){
			          if(file.size>=Minsize&&file.size<=Maxsize){
			             result = '符合要求';
			          }
			          else{result ='图片大小需在'+min+'~'+max+'之间!';}
					}
					else{result ='图片格式不正确!';}
					return result;
			   },
				//预览
			   preview:function (e) {
			   		var file = e.target.files[0];
			   		var result = this.checkFile(file,10,1000);
			   		if(result=='符合要求'){
			   			this.dropDisabled(0);
			   			var url = this.getImgUrl(file);
					   if(url){
					   	 $('.uImg').attr('src',url);
					   }
					}else{this.addDisabled(0);alert(result);}	
			   },
			//更改密码
			  updatePwd:function(){
			  	this.changePwd = false;
			  	this.alterPwd = true;
			  	this.listen = true;
			  },
			 //取消所有操作
			 cancelUtil:function(){
			     this.changePwd=true;
			     this.alterPwd=false;
			     this.listen=false;
			     this.addDisabled(1); 
			 },
	    },
		delimiters:['[[',']]'],
	});
		//表单验证
		function validform(e){var form = e.Validform({tiptype:2,showAllError:true,});}
		validform($('.basic-form'));
		validform($('.account-form'));

   	   //隐私信息加密
		function encyptedInfor(msg,start,num,c){ //start:开始下标 num:替换的长度 c:替换的内容
			if(start<0){start=0}
			if(start+num>msg.length){alter("截取下标错误");}
			var t = msg.replace(msg.substr(start,num),c);
			return t;
		}
		$('.encypted-email').html(encyptedInfor($('.encypted-email').eq(1).text(),2,4,'****'));

		//信息提示
		function showMoal_msg(msg){$('#inforMention-Modal').modal('show').find('.modal-body').html(msg);}
		//发送修改邮箱验证邮件
		$('#alterEmail-sure').click(function(event) {
			$('#changeEmail-Modal').modal('hide');

			$.ajax({
				url:'/user/send/email/alterEmail',
				type:'GET',
				datatype:'text',
				data:'',
				success:function(con){
					if(con=='发送成功'){showMoal_msg('验证邮件已发送到你的原邮箱,请前往查看');}
					else if(con=='发送失败'){showMoal_msg('验证邮件发送失败,请稍后再试');}
					else{showMoal_msg(con);}
				},
				error:function(){showMoal_msg('请求失败,请稍后再试');},
			});
		});
});